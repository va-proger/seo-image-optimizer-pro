(function(){"use strict";async function p(e,n,o){const t=await createImageBitmap(e),a=new OffscreenCanvas(t.width,t.height);return a.getContext("2d").drawImage(t,0,0),await a.convertToBlob({type:n,quality:o})}async function h(e,n,o){let t=null;try{if(t=await e.convertToBlob({type:n,quality:o}),t)return t}catch{}try{if(t=await e.convertToBlob({type:n}),t)return t}catch{}try{if(t=await e.convertToBlob({type:"image/webp",quality:o}),t)return t}catch{}return e.convertToBlob({type:"image/jpeg",quality:.9})}self.onmessage=async e=>{const{id:n,file:o,settings:t}=e.data,{quality:a,format:i,stripMetadata:u,sizes:w}=t,c=await createImageBitmap(o),l=[];for(const r of w.map(Number)){const d=r/c.width,g=Math.round(c.height*d),f=new OffscreenCanvas(r,g);f.getContext("2d").drawImage(c,0,0,r,g);let s=await h(f,i,a);u&&(s=await p(s,i,a)),l.push({width:r,height:g,blob:s,size:s.size,format:i})}self.postMessage({id:n,status:"done",payload:l})}})();
